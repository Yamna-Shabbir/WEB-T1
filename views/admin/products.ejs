<%- include('layout', {
  title: 'Products Management - Admin Panel',
  page: 'products',
  pageTitle: 'Products Management',
  body: `
    <div class="admin-card">
      <div class="admin-card-header">
        <h3>All Products</h3>
        <a href="/admin/products/add" class="btn-admin btn-primary-admin">
          <i class="fa-solid fa-plus"></i> Add New Product
        </a>
      </div>
      
      <div id="alertContainer"></div>
      
      <div id="productsTableContainer">
        <p class="text-center text-muted">Loading products...</p>
      </div>
    </div>
  `,
  scripts: `
    <script>
      async function loadProducts() {
        try {
          const response = await fetch('/api/products');
          const data = await response.json();
          
          const container = document.getElementById('productsTableContainer');
          
          if (data.success && data.products && data.products.length > 0) {
            container.innerHTML = '<div class="table-responsive"><table class="admin-table"><thead><tr><th>Image</th><th>Name</th><th>Category</th><th>Price</th><th>Stock</th><th>Actions</th></tr></thead><tbody>' +
              data.products.map(product => {
                const stockBadge = (product.stock || 0) > 0 
                  ? '<span class="badge-admin badge-success">In Stock (' + product.stock + ')</span>'
                  : '<span class="badge-admin badge-danger">Out of Stock</span>';
                
                return '<tr>' +
                  '<td><img src="' + product.image + '" alt="' + product.name + '" style="width: 50px; height: 50px; object-fit: cover; border-radius: 4px;" onerror="this.src=\\'/images/image.png\\'"></td>' +
                  '<td><strong>' + product.name + '</strong><br><small class="text-muted">' + (product.description || '').substring(0, 50) + '...</small></td>' +
                  '<td><span class="badge-admin badge-info">' + product.category + '</span></td>' +
                  '<td>$' + parseFloat(product.price).toFixed(2) + '</td>' +
                  '<td>' + stockBadge + '</td>' +
                  '<td>' +
                    '<a href="/admin/products/' + product._id + '/edit" class="btn-admin btn-sm-admin btn-warning-admin" style="margin-right: 0.5rem;"><i class="fa-solid fa-edit"></i> Edit</a>' +
                    '<button onclick="deleteProduct(' + "'" + product._id + "'" + ')" class="btn-admin btn-sm-admin btn-danger-admin"><i class="fa-solid fa-trash"></i> Delete</button>' +
                  '</td>' +
                '</tr>';
              }).join('') +
              '</tbody></table></div>';
          } else {
            container.innerHTML = '<div class="empty-state"><i class="fa-solid fa-box-open"></i><h3>No products found</h3><p>Get started by adding your first product.</p><a href="/admin/products/add" class="btn-admin btn-primary-admin mt-3"><i class="fa-solid fa-plus"></i> Add Product</a></div>';
          }
        } catch (error) {
          console.error('Error loading products:', error);
          document.getElementById('productsTableContainer').innerHTML = '<div class="alert-admin alert-error"><i class="fa-solid fa-exclamation-circle"></i> Error loading products. Please refresh the page.</div>';
        }
      }

      async function deleteProduct(id) {
        if (!confirm('Are you sure you want to delete this product? This action cannot be undone.')) {
          return;
        }

        try {
          const response = await fetch('/api/products/' + id, {
            method: 'DELETE'
          });
          
          const data = await response.json();
          
          if (data.success) {
            showAlert('Product deleted successfully', 'success');
            loadProducts();
          } else {
            showAlert(data.message || 'Error deleting product', 'error');
          }
        } catch (error) {
          console.error('Error deleting product:', error);
          showAlert('Error deleting product. Please try again.', 'error');
        }
      }

      function showAlert(message, type) {
        const container = document.getElementById('alertContainer');
        const alertClass = type === 'success' ? 'alert-success' : type === 'error' ? 'alert-error' : 'alert-info';
        container.innerHTML = '<div class="alert-admin ' + alertClass + '"><i class="fa-solid fa-' + (type === 'success' ? 'check-circle' : 'exclamation-circle') + '"></i> ' + message + '</div>';
        
        setTimeout(() => {
          container.innerHTML = '';
        }, 5000);
      }

      document.addEventListener('DOMContentLoaded', function() {
        loadProducts();
      });
    </script>
  `
}) %>




